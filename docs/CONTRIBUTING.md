# docs パッケージ開発ガイド

このドキュメントでは、docs パッケージ（Docusaurus サイト）の開発・保守に必要な情報を説明します。

> 全体的な貢献ガイドライン（セットアップ、コミット規約、CI/CD 等）は [ルート CONTRIBUTING.md](../CONTRIBUTING.md) を参照してください。

## 目次

- [開発サーバー](#開発サーバー)
- [ビルド](#ビルド)
  - [GitHub Pages 向けビルド](#github-pages-向けビルド)
- [プレビュー](#プレビュー)
- [ドキュメント作成](#ドキュメント作成)
  - [新規ドキュメントの追加](#新規ドキュメントの追加)
  - [カテゴリの追加](#カテゴリの追加)
  - [サイドバー設定](#サイドバー設定)
- [国際化（i18n）](#国際化i18n)
- [ダイアグラム作成](#ダイアグラム作成)
  - [サポートフォーマット](#サポートフォーマット)
  - [ディレクトリ構造](#ディレクトリ構造)
  - [drawio 図の作成・編集](#drawio-図の作成編集)
  - [テンプレート](#テンプレート)
  - [ダイアグラム変換](#ダイアグラム変換)
  - [Markdown からの参照](#markdown-からの参照)
  - [注意事項](#注意事項)
- [ディレクトリ構成](#ディレクトリ構成)
- [型チェック](#型チェック)

## 開発サーバー

```bash
# 日本語版で起動
pnpm start

# 英語版で起動
pnpm start --locale en
```

ブラウザで <http://localhost:3000> を開きます。ファイルを編集すると自動的に反映されます。

## ビルド

```bash
pnpm build
```

`build/` ディレクトリに静的ファイルが生成されます。

### GitHub Pages 向けビルド

```bash
BASE_URL=/sample-design-docs-docusaurus/ pnpm build
```

## プレビュー

```bash
pnpm serve
```

ビルド済みサイトをローカルでプレビューします。

## ドキュメント作成

### 新規ドキュメントの追加

1. `content/` 配下の適切なカテゴリに Markdown ファイルを追加
2. frontmatter で `sidebar_position` を指定して並び順を制御

```markdown
---
sidebar_position: 1
title: ドキュメントタイトル
description: ドキュメントの説明
---

# ドキュメントタイトル

本文...
```

### カテゴリの追加

新しいカテゴリを追加する場合は、ディレクトリ内に `_category_.json` を作成します。

```json
{
  "label": "カテゴリ名",
  "position": 1,
  "description": "カテゴリの説明"
}
```

### サイドバー設定

サイドバーは `sidebars.ts` で定義されています。`autogenerated` を使用しているため、`content/` 配下のディレクトリ構造が自動的にサイドバーに反映されます。

## 国際化（i18n）

- デフォルト言語: 日本語 (`ja`)
- 対応言語: 英語 (`en`)

翻訳ファイルの生成:

```bash
pnpm docusaurus write-translations --locale en
```

## ダイアグラム作成

本プロジェクトでは、テキストベースのダイアグラム記法をサポートしています。

### サポートフォーマット

| フォーマット   | 拡張子           | 用途                                            |
| -------- | ------------- | --------------------------------------------- |
| PlantUML | `.puml`       | シーケンス図、クラス図、状態図等                              |
| Mermaid  | `.mmd`        | フローチャート、シーケンス図、ガント図等                          |
| GraphViz | `.dot`        | グラフ、ネットワーク図                                   |
| D2       | `.d2`         | モダンなダイアグラム言語                                  |
| drawio   | `.drawio.png` | GUI 編集可能な汎用図（変換不要）                            |
| その他      | 各種            | actdiag, nwdiag, ditaa, excalidraw, nomnoml 等 |

### ディレクトリ構造

```text
static/diagrams/
├── src/                    # ソースファイル（kroki 形式）
│   ├── plantuml/
│   │   └── *.puml
│   ├── mermaid/
│   │   └── *.mmd
│   ├── graphviz/
│   │   └── *.dot
│   └── d2/
│       └── *.d2
├── output/                 # 出力ファイル（自動生成）
│   ├── plantuml/
│   │   └── *.svg
│   ├── mermaid/
│   │   └── *.svg
│   └── ...
└── drawio/                 # drawio.png 形式（直接配置・編集）
    └── *.drawio.png
```

### drawio 図の作成・編集

`.drawio.png` 形式は PNG 画像でありながら編集データを内包しているため、変換処理が不要です。

- **作成**: VS Code の Draw\.io 拡張または draw\.io Desktop で `.drawio.png` として保存
- **編集**: VS Code で直接開いて編集可能。保存時に PNG 画像部分が自動更新される
- **参照**: `![図](/diagrams/drawio/xxx.drawio.png)` で直接参照

### テンプレート

各フォーマットの `_templates/` ディレクトリにテンプレートファイルがあります。新規作成時の参考にしてください。

```text
static/diagrams/src/plantuml/_templates/
├── sequence.puml      # シーケンス図
├── class.puml         # クラス図
├── activity.puml      # アクティビティ図
└── ...
```

### ダイアグラム変換

kroki 形式のソースファイルを SVG に変換するには、kroki サーバーが必要です。

```bash
# 1. kroki サーバー起動
pnpm kroki:up

# 2. 変換実行
pnpm diagrams:kroki      # kroki 対応フォーマット（PlantUML, Mermaid 等）

# 3. サーバー停止
pnpm kroki:down
```

> **Note**: drawio は `.drawio.png` を直接配置するため、変換コマンドは不要です。

### Markdown からの参照

```markdown
## シーケンス図
![認証フロー](/diagrams/output/plantuml/auth-sequence.svg)

## フローチャート
![処理フロー](/diagrams/output/mermaid/basic-flowchart.svg)

## drawio 図
![システム構成図](/diagrams/drawio/system-architecture.drawio.png)
```

### 注意事項

- **公開サーバー使用禁止**: kroki 変換はローカルサーバー（`docs/docker/compose.yaml`）のみ使用
- **Docker 必須**: kroki サーバーの実行に必要
- **kroki CLI**: mise で管理（`mise install` でインストール）
- **自動変換**: kroki 形式（PlantUML, GraphViz, D2 等）はコミット時に自動変換される（lefthook 経由）
- **drawio は変換不要**: `.drawio.png` を直接配置・編集するため Docker 不要

## ディレクトリ構成

```text
docs/
├── content/              # ドキュメント（Markdown）
│   ├── intro.md
│   ├── adr/             # Architecture Decision Records
│   ├── architecture/    # アーキテクチャ設計
│   ├── specifications/  # 仕様書
│   ├── guides/          # ガイド・手順書
│   ├── frontend/        # フロントエンド関連
│   ├── bff/             # Backend for Frontend 関連
│   └── api/             # API ドキュメント（自動生成）
├── src/                  # React コンポーネント・ページ
│   ├── css/             # カスタムスタイル
│   ├── pages/           # ページコンポーネント
│   └── theme/           # テーマカスタマイズ
├── static/               # 静的アセット
│   ├── img/             # 画像
│   └── diagrams/        # ダイアグラム
├── scripts/              # 変換スクリプト
├── i18n/                 # 国際化ファイル
├── docusaurus.config.ts  # Docusaurus 設定
└── sidebars.ts           # サイドバー設定
```

## 型チェック

```bash
pnpm typecheck
```
